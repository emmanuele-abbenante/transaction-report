--Expenses grouped by kind
SELECT 
CASE
	WHEN COUNTERPART = 'PENNY MARKET' THEN 'Spesa'
	WHEN COUNTERPART = 'PAM PANORAMA MI TIBALDI' THEN 'Spesa'
	WHEN COUNTERPART = 'CDC 1070 SMA MILANO SAN G' THEN 'Spesa'
	WHEN COUNTERPART = 'UPIM SAN GOTTARDO' THEN 'Abbigliamento'
	WHEN COUNTERPART = 'FARMACIA STAZIONE PORTA G' THEN 'Farmaci'
	WHEN COUNTERPART = 'FARMACIA MONCUCCO SNC' THEN 'Farmaci'
	WHEN COUNTERPART = 'BEATO TE' THEN 'Pranzi lavoro'
	WHEN COUNTERPART = 'SCARPAMONDO' THEN 'Abbigliamento'
	WHEN COUNTERPART = 'ATLANTIC LORENTEGGIO' THEN 'Pranzi lavoro'
	WHEN COUNTERPART = 'ESSELUNGA LORENTEGGIO' THEN 'Spesa'
    WHEN COUNTERPART = 'CDC 4250 SMA MI TIBAL 920' THEN 'Spesa'
	WHEN COUNTERPART = 'CASH ISP 1221-MILAN' THEN 'Prelievo'
    WHEN COUNTERPART = 'CASH ISP 1220-MILAN' THEN 'Prelievo'
    WHEN COUNTERPART = 'BANCA POP DI MILANO' THEN 'Prelievo'
    WHEN COUNTERPART = 'UBI BANCA MILANO' THEN 'Prelievo'
	WHEN COUNTERPART = 'Gabriella Gruppi' THEN 'Affitto'
    WHEN COUNTERPART = 'MEDIAWORLD MI TROYA CC' THEN 'Tempo libero'
    WHEN COUNTERPART = 'LORETO ARGENTINA M12' THEN 'Abbonamento mezzi'
	WHEN COUNTERPART = 'CREPEATALY S.R.L. SEMPLIF' THEN 'Cene/aperitivi/etc'
    WHEN COUNTERPART = 'ESSELUNGA LORENTEGGIO 697' THEN 'Spesa'
    WHEN COUNTERPART = 'FABBRISCA VAPORE 7 - U' THEN 'Tempo libero'
    WHEN COUNTERPART = 'FARMACIA TIBALDI' THEN 'Farmaci'
    WHEN COUNTERPART = 'MC DONALD S' THEN 'Pranzi lavoro'
    WHEN COUNTERPART = 'MC DONALD S 990' THEN 'Pranzi lavoro'
    WHEN COUNTERPART = 'OVIESSE' THEN 'Abbigliamento'
    WHEN COUNTERPART = 'PENNY MARKET 375' THEN 'Spesa'
    WHEN COUNTERPART = 'PRINCI' THEN 'Cene/aperitivi/etc'
    WHEN COUNTERPART = 'TINTORIA LAVANDERIA DI TE' THEN 'Abbigliamento'
    WHEN COUNTERPART = 'VENCHI 384' THEN 'Cene/aperitivi/etc'
END AS Spesa,
''  AS Controparte,
SUM(CURRENCY_AMOUNT) AS Importo
FROM TRANSACTIONS
WHERE COUNTERPART IN (
'PENNY MARKET', 
'PAM PANORAMA MI TIBALDI', 
'CDC 1070 SMA MILANO SAN G', 
'UPIM SAN GOTTARDO', 
'FARMACIA STAZIONE PORTA G', 
'FARMACIA MONCUCCO SNC', 
'BEATO TE', 
'SCARPAMONDO', 
'ATLANTIC LORENTEGGIO', 
'ESSELUNGA LORENTEGGIO', 
'CASH ISP 1221-MILAN', 
'BANCA POP DI MILANO', 
'Gabriella Gruppi', 
'MEDIAWORLD MI TROYA CC', 
'LORETO ARGENTINA M12',
'CASH ISP 1220-MILAN', 
'UBI BANCA MILANO',
'CDC 4250 SMA MI TIBAL 920',
'CREPEATALY S.R.L. SEMPLIF',
'ESSELUNGA LORENTEGGIO 697',
'FABBRISCA VAPORE 7 - U',
'FARMACIA TIBALDI',
'MC DONALD S',
'MC DONALD S 990',
'OVIESSE',
'PENNY MARKET 375',
'PRINCI',
'TINTORIA LAVANDERIA DI TE',
'VENCHI 384'
)
GROUP BY Spesa

UNION

SELECT 
REASON AS Spesa,
COUNTERPART AS Controparte,
SUM(CURRENCY_AMOUNT) AS Importo
FROM TRANSACTIONS
WHERE COUNTERPART NOT IN (
'PENNY MARKET',
'PAM PANORAMA MI TIBALDI',
'CDC 1070 SMA MILANO SAN G',
'UPIM SAN GOTTARDO',
'FARMACIA STAZIONE PORTA G',
'FARMACIA MONCUCCO SNC',
'BEATO TE',
'SCARPAMONDO',
'ATLANTIC LORENTEGGIO',
'ESSELUNGA LORENTEGGIO',
'CASH ISP 1221-MILAN',
'BANCA POP DI MILANO',
'Gabriella Gruppi',
'MEDIAWORLD MI TROYA CC',
'LORETO ARGENTINA M12',
'CASH ISP 1220-MILAN',
'UBI BANCA MILANO',
'CDC 4250 SMA MI TIBAL 920',
'CREPEATALY S.R.L. SEMPLIF',
'ESSELUNGA LORENTEGGIO 697',
'FABBRISCA VAPORE 7 - U',
'FARMACIA TIBALDI',
'MC DONALD S',
'MC DONALD S 990',
'OVIESSE',
'PENNY MARKET 375',
'PRINCI',
'TINTORIA LAVANDERIA DI TE',
'VENCHI 384'
)
OR COUNTERPART IS NULL
GROUP BY REASON, COUNTERPART

UNION

SELECT 
'Totale' AS Spesa,
'' AS Controparte,
SUM(CURRENCY_AMOUNT) AS Importo
from TRANSACTIONS;